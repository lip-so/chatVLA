#!/bin/bash

echo "üîç RAILWAY DEPLOYMENT STATUS CHECK"
echo "===================================="
echo ""
echo "Let's diagnose your Railway deployment..."
echo ""

# Check current frontend configuration
echo "1Ô∏è‚É£ Current Frontend Configuration:"
echo "-----------------------------------"
if grep -q "chatvla-mock-backend.glitch.me" frontend/js/config.js; then
    echo "‚ùå Frontend is still using MOCK backend"
    echo "   This means Railway URL hasn't been configured yet"
else
    CURRENT_URL=$(grep "return 'https://" frontend/js/config.js | grep -o "https://[^']*" | head -1)
    echo "‚úÖ Frontend is configured with: $CURRENT_URL"
fi
echo ""

echo "2Ô∏è‚É£ What You Should See in Railway Dashboard:"
echo "---------------------------------------------"
echo "Go to: https://railway.app/dashboard"
echo ""
echo "Your 'chatVLA' project should show:"
echo "  ‚Ä¢ Service Status: ‚úÖ Active (green)"
echo "  ‚Ä¢ Latest Deployment: ‚úÖ Success"
echo "  ‚Ä¢ Build Logs: No errors"
echo "  ‚Ä¢ Deploy Logs: 'Starting Flask app on port 8080'"
echo ""

echo "3Ô∏è‚É£ How to Get Your Railway URL:"
echo "---------------------------------"
echo "METHOD A: Check Service Page"
echo "  1. Click on your service in Railway"
echo "  2. Look at the TOP of the panel"
echo "  3. You might see the URL already displayed"
echo ""
echo "METHOD B: Add PORT Variable (triggers domain)"
echo "  1. Click Variables tab"
echo "  2. Add: PORT = 8080"
echo "  3. Save and wait for redeploy"
echo "  4. Domain option will appear"
echo ""
echo "METHOD C: Use Railway CLI"
echo "  brew install railway"
echo "  railway login"
echo "  railway link"
echo "  railway domain"
echo ""

echo "4Ô∏è‚É£ Common Issues & Fixes:"
echo "--------------------------"
echo "‚ùå If deployment is FAILING:"
echo "   - Check Deploy Logs for errors"
echo "   - Common: missing dependencies, wrong start command"
echo ""
echo "‚ùå If deployment is SUCCESS but no domain option:"
echo "   - Add PORT=8080 to Variables"
echo "   - Wait for redeploy"
echo ""
echo "‚ùå If you see 'TCP Proxy' instead of HTTP:"
echo "   - Delete the TCP Proxy"
echo "   - Add PORT variable"
echo "   - Domain option will appear"
echo ""

echo "5Ô∏è‚É£ Once You Have Your Railway URL:"
echo "-----------------------------------"
echo "Run this command with YOUR Railway URL:"
echo "./update_backend_url.sh https://chatvla-production-xxxx.up.railway.app"
echo ""
echo "This will:"
echo "  ‚Ä¢ Update frontend/js/config.js"
echo "  ‚Ä¢ Commit and push to GitHub"
echo "  ‚Ä¢ GitHub Pages will update in 1-2 minutes"
echo "  ‚Ä¢ Your site will be fully functional!"
echo ""

echo "üìä CURRENT STATUS:"
echo "=================="
echo "‚úÖ Frontend: https://tunerobotics.xyz (GitHub Pages)"
echo "‚ö†Ô∏è  Backend: Waiting for Railway URL configuration"
echo ""
echo "ACTION REQUIRED: Get your Railway URL and run update script!"